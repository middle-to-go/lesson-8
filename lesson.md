---
customTheme : "presentation"

---

## –õ–µ–∫—Ü–∏—è 8. –ë—Ä–æ–∫–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π. –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞. –ú–µ—Ç—Ä–∏–∫–∏. –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.    

### OZON

### –ú–æ—Å–∫–≤–∞, 2021


---

### –õ–µ–∫—Ü–∏–∏

1. <span style="color:gray">–í–≤–µ–¥–µ–Ω–∏–µ. –†–∞–±–æ—á–µ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π.</span>
2. <span style="color:gray">–ë–∞–∑–æ–≤—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã. –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö.</span>
3. <span style="color:gray">–°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö, –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –æ—Å–Ω–æ–≤—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</span>
4. <span style="color:gray">–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –º–æ–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –Ω–∏–º–∏ </span>
5. <span style="color:gray">–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤ Go</span>
6. <span style="color:gray">Protobuf –∏ gRPC</span>
7. <span style="color:gray">–†–∞–±–æ—Ç–∞ —Å –ë–î –≤ Go</span>
8. –ë—Ä–æ–∫–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π. –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞. –ú–µ—Ç—Ä–∏–∫–∏. –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.

---

### –¢–µ–º—ã

–°–µ–≥–æ–¥–Ω—è –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –ø—Ä–æ:

1. –ë—Ä–æ–∫–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π: –∑–∞—á–µ–º –∏ –∫–∞–∫ —Å —ç—Ç–∏–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å (–Ω–∞ –ø—Ä–∏–º–µ—Ä–µ Apache Kafka). <!-- .element: class="fragment" -->
2. –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞: –∫–æ–≥–¥–∞ –ª–æ–≥–æ–≤ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ. <!-- .element: class="fragment" -->
3. –ú–µ—Ç—Ä–∏–∫–∏: –±–∏–µ–Ω–∏–µ —Å–µ—Ä–¥—Ü–∞ –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞. <!-- .element: class="fragment" -->
4. –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –∫–∞–∫ —Å—Ç—Ä–µ–ª—è—Ç—å –ø–æ —Å–µ—Ä–≤–∏—Å—É. <!-- .element: class="fragment" -->

---

### –û–±–æ–∑–Ω–∞—á–µ–Ω–∏—è

* üìΩÔ∏è - –ø–æ—Å–º–æ—Ç—Ä–∏ –≤–æ—Ä–∫—à–æ—É
* ‚öóÔ∏è - –ø—Ä–æ–≤–µ–¥–∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç
* üî¨ - –∏–∑—É—á–∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ
* üìñ - –ø—Ä–æ—á–∏—Ç–∞–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
* ü™ô - –ø–æ–¥—É–º–∞–π –æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
* üêû - –∑–∞–ø–æ–º–Ω–∏ –æ—à–∏–±–∫—É
* üî® - –∑–∞–ø–æ–º–Ω–∏ —Ä–µ—à–µ–Ω–∏–µ
* üèîÔ∏è - –æ–±–æ–π–¥–∏ –∫–∞–º–µ–Ω—å –ø—Ä–µ–¥–∫–Ω–æ–≤–µ–Ω—å—è
* ‚è∞ - —Å–¥–µ–ª–∞–π –ø–µ—Ä–µ—Ä—ã–≤
* üè° - –ø–æ–ø—Ä–æ–±—É–π –¥–æ–º–∞
* üí° - –æ–±—Å—É–¥–∏ —Å–≤–µ—Ç–ª—ã–µ –∏–¥–µ–∏
* üôã - –∑–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å
* ‚ö° - –∑–∞–ø–æ–º–Ω–∏ –ø–∞–Ω–∏–∫—É



---

### –ß—Ç–æ —Ç–∞–∫–æ–µ –ª–æ–≥?

–ê –≤–æ–æ–±—â–µ —á—Ç–æ —Ç–∞–∫–æ–µ –ª–æ–≥?

–õ–æ–≥ -- —ç—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, –≤ –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω–µ—Ü. <!-- .element: class="fragment" --> 

–ò–∑ –ª–æ–≥–∞ –º–æ–∂–Ω–æ –ø—Ä–æ—á–µ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, —Ç–æ–ª—å–∫–æ –∑–Ω–∞—è –µ–≥–æ —Å–º–µ—â–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–∞—á–∞–ª–∞ –ª–æ–≥–∞. <!-- .element: class="fragment" -->

–° —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è -- –±—Ä–æ–∫–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å –ª–æ–≥–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤ –∏—Ö –º–∏—Ä–µ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è –æ—á–µ—Ä–µ–¥—è–º–∏ —Å–æ–æ–±—â–µ–Ω–∏–π. <!-- .element: class="fragment" -->

---

### –ß—Ç–æ —Ç–∞–∫–æ–µ –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π?

–í –∏–¥–µ–∞–ª—å–Ω–æ–º –º–∏—Ä–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è, –≤—Å—ë –Ω–∞–¥—ë–∂–Ω–æ, –Ω–µ—Ç –Ω–∏ –µ–¥–∏–Ω–æ–≥–æ —Ä–∞–∑—Ä—ã–≤–∞.

–í —Ä–µ–∞–ª—å–Ω–æ–º –µ—Å—Ç—å –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–±–ª–µ–º. –ö–∞–∫–∏—Ö? <!-- .element: class="fragment" -->

1. –ú–æ–∂–µ—Ç –ø—Ä–æ–ø–∞—Å—Ç—å —Å–µ—Ç–µ–≤–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å <!-- .element: class="fragment" -->
2. –ú–æ–≥—É—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –±–∏—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ <!-- .element: class="fragment" -->
3. –°–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç —É–π—Ç–∏ –Ω–µ —Ç—É–¥–∞ <!-- .element: class="fragment" -->
4. –°–æ–æ–±—â–µ–Ω–∏–π –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ <!-- .element: class="fragment" -->
5. –ö–∞–∫–æ–π-—Ç–æ –∏–∑ —Å–µ—Ä–≤–∏—Å–æ–≤ –º–æ–∂–µ—Ç –≤–Ω–µ–∑–∞–ø–Ω–æ —É–º–µ—Ä–µ—Ç—å <!-- .element: class="fragment" -->

---

### –ß—Ç–æ —Ç–∞–∫–æ–µ Kafka?

–ü–û, —Ä–µ–∞–ª–∏–∑—É—é—â–µ–µ –æ—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π:
* —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ <!-- .element: class="fragment" -->
* –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–µ <!-- .element: class="fragment" -->
* –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ–µ <!-- .element: class="fragment" -->
* –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ–µ (–ø–æ–∫–∞ –º—ã –Ω–µ —Ä–µ—à–∏–º –æ—á–∏—Å—Ç–∏—Ç—å) <!-- .element: class="fragment" -->

–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ LinkedIn, –æ—Ç–¥–∞–Ω–æ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è Apache Foundation.  <!-- .element: class="fragment" -->

---

### –ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –æ–Ω–æ –≤ –æ–±—â–µ–º?

<img src="images/kafka_ecosystem.png">


---


### –ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –æ–Ω–æ –≤ –æ–±—â–µ–º?


–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã Kafka —Ä–∞–±–æ—Ç–∞–ª–∞ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ, –µ–π —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å Zookeeper. 

Zookeeper -- —Ö—Ä–∞–Ω–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ —è–≤–ª—è–µ—Ç—Å—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–æ–º –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ Kafka. <!-- .element: class="fragment" -->

---

### –ö–∞–∫ –æ–Ω–æ –≤—Å—ë –≤–Ω—É—Ç—Ä–∏?


<img src="images/patritions_kafka.png">

---

### –ö–∞–∫ –æ–Ω–æ –≤—Å—ë –≤–Ω—É—Ç—Ä–∏?

–°–æ–±—ã—Ç–∏—è –¥–µ–ª—è—Ç—Å—è –ª–æ–≥–∏—á–µ—Å–∫–∏ –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–ø–∏–∫–∏.

–£ —Ç–æ–ø–∏–∫–∞ –µ—Å—Ç—å —Å–≤–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: <!-- .element: class="fragment" -->

1. –æ–±—ä–µ–º —Ö—Ä–∞–Ω–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏/–∏–ª–∏ –∏—Ö –≤–æ–∑—Ä–∞—Å—Ç (retention.bytes, retention.ms) -- —Ç–æ –µ—Å—Ç—å –∫–æ–≥–¥–∞ –º—ã –±—É–¥–µ–º —á–∏—Å—Ç–∏—Ç—å —Ç–æ–ø–∏–∫ –æ—Ç —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π; <!-- .element: class="fragment" -->
2. —Ñ–∞–∫—Ç–æ—Ä –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö (replication factor) -- —Å–∫–æ–ª—å–∫–æ –∫–æ–ø–∏–π —Å–æ–æ–±—â–µ–Ω–∏—è —É –Ω–∞—Å –µ—Å—Ç—å –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ; <!-- .element: class="fragment" -->
3. –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (max.message.bytes); <!-- .element: class="fragment" -->
4. –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ–ø–ª–∏–∫, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –≤ —Ç–æ–ø–∏–∫ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ (min.insync.replicas); <!-- .element: class="fragment" -->
5. –∏ –¥—Ä—É–≥–∏–µ; <!-- .element: class="fragment" -->

---

### –ö–∞–∫ –æ–Ω–æ –≤—Å—ë –≤–Ω—É—Ç—Ä–∏?

–í —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –∫–∞–∂–¥—ã–π —Ç–æ–ø–∏–∫ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –æ–¥–Ω—É –∏ –±–æ–ª–µ–µ –ø–∞—Ä—Ç–∏—Ü–∏—é (partition). –ò–º–µ–Ω–Ω–æ –≤ –ø–∞—Ä—Ç–∏—Ü–∏–∏ –≤ –∏—Ç–æ–≥–µ –ø–æ–ø–∞–¥–∞—é—Ç —Å–æ–±—ã—Ç–∏—è. 

–ï—Å–ª–∏ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ –±—Ä–æ–∫–µ—Ä–∞, —Ç–æ –ø–∞—Ä—Ç–∏—Ü–∏–∏ –±—É–¥—É—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ –≤—Å–µ–º –±—Ä–æ–∫–µ—Ä–∞–º —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ (–Ω–∞—Å–∫–æ–ª—å–∫–æ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ), —á—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –∑–∞–ø–∏—Å—å –∏ —á—Ç–µ–Ω–∏–µ –≤ –æ–¥–∏–Ω —Ç–æ–ø–∏–∫ —Å—Ä–∞–∑—É –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –±—Ä–æ–∫–µ—Ä–æ–≤. <!-- .element: class="fragment" -->

–í –∏—Ç–æ–≥–µ –º–µ—Ö–∞–Ω–∏–∑–º –ø–∞—Ç—Ä–∏—Ü–∏–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å.  <!-- .element: class="fragment" -->



---

### –ß—Ç–æ —Ç–∞–∫–æ–µ producer?

Producer –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ —Ç–æ–ø–∏–∫. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–∞–∫–æ–π-—Ç–æ —Å–µ—Ä–≤–∏—Å, –ª–∏–±–æ –¥–∞–∂–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç.

–ö–∞–∂–¥–æ–µ —Ç–∞–∫–æ–µ —Å–æ–±—ã—Ç–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∏–∑ —Å–µ–±—è –ø–∞—Ä—É –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ.  <!-- .element: class="fragment" -->

–ö–ª—é—á –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –∑–∞–¥–∞–Ω, —Ç–æ–≥–¥–∞ —Å–æ–±—ã—Ç–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –º–µ–∂–¥—É –ø–∞—Ç—Ä–∏—Ü–∏—è–º–∏ –ø–æ –æ—á–µ—Ä–µ–¥–∏ –∏ –º–æ–∂–µ—Ç —Ç–µ—Ä—è—Ç—å—Å—è –∏—Ö —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ—Å—Ç—å.  <!-- .element: class="fragment" -->

–ï—Å–ª–∏ –∫–ª—é—á –∑–∞–¥–∞–Ω, —Ç–æ –æ—Ç –Ω–µ–≥–æ –±–µ—Ä—ë—Ç—Å—è —Ö—ç—à –∏ —Å–æ–±—ã—Ç–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø–æ—Ä—è–¥–∫–∞ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏. <!-- .element: class="fragment" -->

---

### –ß—Ç–æ —Ç–∞–∫–æ–µ consumer?

Consumer —ç—Ç–æ –æ–ø—è—Ç—å –∂–µ –Ω–µ–∫–æ—Ç–æ—Ä—ã–π —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç –ø—Ä–∏—Ö–æ–¥—è—â–∏–µ —Å–æ–±—ã—Ç–∏—è. –û–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–æ–ø–∏–∫–æ–≤.

–í–∞–∂–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –¥–ª—è consumer —è–≤–ª—è–µ—Ç—Å—è offset, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∫ –¥–∞–ª–µ–∫–æ –º—ã –ø—Ä–æ—à–ª–∏ –ø–æ —Ç–æ–ø–∏–∫—É.  <!-- .element: class="fragment" -->

Offset –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ Kafka (enable.auto.commit = true) –∏–ª–∏ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—é —Å –∫–æ–Ω—Å—å—é–º–µ—Ä–∞. –í –ø—Ä–æ–¥–µ –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Ç–æ—Ä–æ–π –≤–∞—Ä–∏–∞–Ω—Ç. <!-- .element: class="fragment" -->

–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ offset –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç —Ä–∞—Å—Ç–∏. <!-- .element: class="fragment" -->

Consumer –º–æ–≥—É—Ç –æ–±—ä–µ–¥–∏–Ω—è—Ç—å—Å—è –≤ –≥—Ä—É–ø–ø—ã. –£ –∫–∞–∂–¥—ã–π –≥—Ä—É–ø–ø—ã —Å–≤–æ–π offset. <!-- .element: class="fragment" -->

---

### –ö–∞–∫ –æ–Ω–æ –≤—Å—ë –≤–Ω—É—Ç—Ä–∏?


<img src="images/patritions_kafka.png">

---

### –ö–∞–∫ –ø–æ–¥–Ω—è—Ç—å –∫–ª–∞—Å—Ç–µ—Ä Kafka?

–†–∞–∑—É–º–µ–µ—Ç—Å—è, —á–µ—Ä–µ–∑ docker.

```yaml
version: "3"

services:
  zookeeper:
    image: confluentinc/cp-zookeeper
    ports:
      - "2181:2181"
    environment:
      zk_id: "1"
      ZOOKEEPER_CLIENT_PORT: 32181
      ZOOKEEPER_TICK_TIME: 2000
      ZOOKEEPER_SYNC_LIMIT: 2


  kafka:
    image: confluentinc/cp-kafka
    depends_on:
      - zookeeper
    ports:
      - "127.0.0.1:9094:9094"
    environment:
      KAFKA_ZOOKEEPER_CONNECT: "zookeeper:32181"
      KAFKA_LISTENERS: INTERNAL://kafka:9092,OUTSIDE://kafka:9094
      KAFKA_ADVERTISED_LISTENERS: INTERNAL://kafka:9092,OUTSIDE://localhost:9094
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: INTERNAL:PLAINTEXT,OUTSIDE:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1

```

–ú–æ–∂–Ω–æ –±–æ–ª—å—à–µ –±—Ä–æ–∫–µ—Ä–æ–≤, –Ω–æ –æ–Ω–∏ –≤—Å–µ –Ω–µ —É–º–µ—Å—Ç–∏–ª–∏—Å—å. –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –∞–¥—Ä–µ—Å–∞ –≤—Å–µ—Ö –±—Ä–æ–∫–µ—Ä–æ–≤.

---



---

### –ö–∞–∫–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω–∞ go –µ—Å—Ç—å –¥–ª—è Kafka?

* Sarama, –∫–æ—Ç–æ—Ä–∞—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å —è–≤–ª—è–µ—Ç—Å—è —Å–∞–º–æ–π –ø–æ–ø—É–ª—è—Ä–Ω–æ–π, –Ω–æ —Å –∫–æ—Ç–æ—Ä–æ–π –¥–æ–≤–æ–ª—å–Ω–æ —Ç—Ä—É–¥–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å. –û–Ω –ø–ª–æ—Ö–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω, API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –ö–∞—Ñ–∫–∏ –∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ Go, —Ç–∞–∫–∏–µ –∫–∞–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã. –¢–∞–∫–∂–µ –ø–µ—Ä–µ–¥–∞–µ—Ç –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –±–æ–ª—å—à–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –≤—ã–¥–µ–ª–µ–Ω–∏–π –ø–∞–º—è—Ç–∏, –±–æ–ª–µ–µ —á–∞—Å—Ç—ã–º —Å–±–æ—Ä–∫–∞–º –º—É—Å–æ—Ä–∞ –∏ –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –ø–∞–º—è—Ç–∏.

https://github.com/Shopify/sarama

---

### –ö–∞–∫–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω–∞ go –µ—Å—Ç—å –¥–ª—è Kafka?

* –°onfluent-kafka-go-—ç—Ç–æ –æ–±–æ–ª–æ—á–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ cgo –≤–æ–∫—Ä—É–≥ librdkafka, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–Ω–∞ –≤–≤–æ–¥–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ C –æ—Ç –≤—Å–µ–≥–æ –∫–æ–¥–∞ Go, –∏—Å–ø–æ–ª—å–∑—É—é—â–µ–≥–æ –ø–∞–∫–µ—Ç. –û–Ω –∏–º–µ–µ—Ç –≥–æ—Ä–∞–∑–¥–æ –ª—É—á—à—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, —á–µ–º sarama, –Ω–æ –≤—Å–µ –µ—â–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã Go.

https://github.com/confluentinc/confluent-kafka-go

---

### –ö–∞–∫–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω–∞ go –µ—Å—Ç—å –¥–ª—è Kafka?


* goka - —ç—Ç–æ –±–æ–ª–µ–µ –ø–æ–∑–¥–Ω–∏–π –∫–ª–∏–µ–Ω—Ç Kafka –¥–ª—è Go, –∫–æ—Ç–æ—Ä—ã–π —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º —à–∞–±–ª–æ–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –û–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ö–∞—Ñ–∫–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —à–∏–Ω—ã –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –º–µ–∂–¥—É —Å–ª—É–∂–±–∞–º–∏, –∞ –Ω–µ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ–≥–æ –∂—É—Ä–Ω–∞–ª–∞ —Å–æ–±—ã—Ç–∏–π, –Ω–æ —ç—Ç–æ –Ω–µ —Ç–∏–ø–∏—á–Ω—ã–π —Å–ª—É—á–∞–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ö–∞—Ñ–∫–∏ –¥–ª—è –Ω–∞—Å –≤ —Å–µ–≥–º–µ–Ω—Ç–µ. –ü–∞–∫–µ—Ç —Ç–∞–∫–∂–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Sarama –¥–ª—è –≤—Å–µ—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π —Å –ö–∞—Ñ–∫–æ–π.

https://github.com/lovoo/goka

---

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π Sarama. Consumer

```go
package main

import (
	"fmt"

	"github.com/Shopify/sarama"
)

func subscribe(topic string, consumer sarama.Consumer) {
	partitionList, err := consumer.Partitions(topic) //get all partitions on the given topic
	if err != nil {
		fmt.Println("Error retrieving partitionList ", err)
	}
	initialOffset := sarama.OffsetOldest //get offset for the oldest message on the topic

	for _, partition := range partitionList {
		pc, _ := consumer.ConsumePartition(topic, partition, initialOffset)

		go func(pc sarama.PartitionConsumer) {
			for message := range pc.Messages() {
				messageReceived(message)
			}
		}(pc)
	}
}

func messageReceived(message *sarama.ConsumerMessage) {
	saveMessage(string(message.Value))
}
```



---

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π. Producer

```go
package main

import "github.com/Shopify/sarama"

var brokers = []string{"127.0.0.1:9094"}

func newProducer() (sarama.SyncProducer, error) {
	config := sarama.NewConfig()
	config.Producer.Partitioner = sarama.NewRandomPartitioner
	config.Producer.RequiredAcks = sarama.WaitForAll
	config.Producer.Return.Successes = true
	producer, err := sarama.NewSyncProducer(brokers, config)

	return producer, err
}

func prepareMessage(topic, message string) *sarama.ProducerMessage {
	msg := &sarama.ProducerMessage{
		Topic:     topic,
		Partition: -1,
		Value:     sarama.StringEncoder(message),
	}

	return msg
}
```

---

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π. Main.go


```go
package main

import (
	"fmt"
	"html"
	"log"
	"net/http"

	"github.com/Shopify/sarama"
)

const topic = "sample-topic"

func main() {
	producer, err := newProducer()
	if err != nil {
		fmt.Println("Could not create producer: ", err)
	}

	consumer, err := sarama.NewConsumer(brokers, nil)
	if err != nil {
		fmt.Println("Could not create consumer: ", err)
	}

	subscribe(topic, consumer)

	http.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) { fmt.Fprint(w, "Hello Sarama!") })
```

---

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π. Main.go
```go
	http.HandleFunc("/save", func(w http.ResponseWriter, r *http.Request) {
		defer r.Body.Close()
		r.ParseForm()
		msg := prepareMessage(topic, r.FormValue("q"))
		partition, offset, err := producer.SendMessage(msg)
		if err != nil {
			fmt.Fprintf(w, "%s error occured.", err.Error())
		} else {
			fmt.Fprintf(w, "Message was saved to partion: %d.\nMessage offset is: %d.\n", partition, offset)
		}
	})

	http.HandleFunc("/retrieve", func(w http.ResponseWriter, r *http.Request) { fmt.Fprint(w, html.EscapeString(getMessage())) })

	log.Fatal(http.ListenAndServe(":8081", nil))
}
```

---

### –ë–æ–ª—å—à–µ –ø—Ä–æ Kafka

1. Apache Kafka: –ß—Ç–æ —ç—Ç–æ –∏ –∫–∞–∫ –æ–Ω–∞ –∏–∑–º–µ–Ω–∏—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è https://www.youtube.com/watch?v=nkYW7YqJYmE
2. Apache Kafka, –æ—Ç–∫—Ä—ã—Ç—ã–π –±–∞–∑–æ–≤—ã–π –∫—É—Ä—Å: https://www.youtube.com/playlist?list=PL8D2P0ruohOAR7DAkEjhOqlQreg9rxBMu

---

### –ß—Ç–æ —Ç–∞–∫–æ–µ –º–µ—Ç—Ä–∏–∫–∏?

–ú–µ—Ç—Ä–∏–∫–∏ -- —ç—Ç–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–æ–±—â–∞–µ—Ç –≤–∞—à —Å–µ—Ä–≤–∏—Å –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –û–Ω–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å –∑–¥–æ—Ä–æ–≤—ã–π, –∫–∞–∫ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.

–ú–µ—Ç—Ä–∏–∫–∏ –ø–∏—à—É—Ç—Å—è –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –∫–æ—Ç–æ—Ä–æ–µ —Ö—Ä–∞–Ω–∏—Ç –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –≤—Ä–µ–º–µ–Ω–∏. –≠—Ç–æ –µ—â—ë –æ–¥–∏–Ω –≤–∏–¥ –ë–î, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–µ—Ä–∏—Ä—É–µ—Ç –∏–º–µ–Ω–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è–º–∏. <!-- .element: class="fragment" -->

---

### –ö–∞–∫–∏–µ –±—ã–≤–∞—é—Ç —Ç–∏–ø—ã –º–µ—Ç—Ä–∏–∫?

* —Å—á—ë—Ç—á–∏–∫ (counter) ‚Äî —Ö—Ä–∞–Ω–∏—Ç –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç—Å—è —Å —Ç–µ—á–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–µ—Ä—É); <!-- .element: class="fragment" -->
* —à–∫–∞–ª–∞ (gauge) ‚Äî —Ö—Ä–∞–Ω–∏—Ç –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —Å —Ç–µ—á–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏ –º–æ–≥—É—Ç –∫–∞–∫ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å—Å—è, —Ç–∞–∫ –∏ —É–º–µ–Ω—å—à–∞—Ç—å—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±—ä—ë–º –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –∏–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞); <!-- .element: class="fragment" -->
* –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ (histogram) ‚Äî —Ö—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–µ–∫–æ—Ç–æ—Ä–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–µ–∂—É—Ç–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–µ—Ä—É –≤ –ø–µ—Ä–∏–æ–¥ —Å 11 –¥–æ 12 —á–∞—Å–æ–≤ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —ç—Ç–æ–º—É –∂–µ —Å–µ—Ä–≤–µ—Ä–æ–≤ –≤ –ø–µ—Ä–∏–æ–¥ —Å 11.30 –¥–æ 11.40); <!-- .element: class="fragment" -->
* —Å–≤–æ–¥–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (summary) ‚Äî –∫–∞–∫ –∏ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞, —Ö—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ–∫–æ—Ç–æ—Ä–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∑–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª, –Ω–æ —Ç–∞–∫–∂–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –∫–≤–∞–Ω—Ç–∏–ª–∏ –¥–ª—è —Å–∫–æ–ª—å–∑—è—â–∏—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤. <!-- .element: class="fragment" -->

---

### –ß—Ç–æ —Ç–∞–∫–æ–µ –º–µ—Ç—Ä–∏–∫–∏?

–£ –∑–Ω–∞—á–µ–Ω–∏–π –º–µ—Ç—Ä–∏–∫ –º–æ–≥—É—Ç –ø—Ä–æ—Å—Ç–∞–≤–ª—è—Ç—å—Å—è —Ä–∞–∑–Ω—ã–µ –º–µ—Ç–∫–∏ (labels). –ü—Ä–∏–º–µ—Ä –º–µ—Ç—Ä–∏–∫–∏:

http_response_code -- –µ—ë –∑–Ω–∞—á–µ–Ω–∏–µ -- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ . –û–Ω–∞ –∏–º–µ–µ—Ç —Ç–∏–ø counter. <!-- .element: class="fragment" -->

–ï—ë –º–µ—Ç–∫–∏: browser, response_code, time_grade, handle. <!-- .element: class="fragment" -->

–í—ã–±–æ—Ä–∫–∏ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–∞–∂–¥–æ–π –º–µ—Ç–∫–∏. –¢–æ –µ—Å—Ç—å –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤–µ—Ä–Ω—É–ª–∏ 404 –∏–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Ä—É—á–∫–µ, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –∑–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –≤—Ä–µ–º—è. <!-- .element: class="fragment" -->

---

### –ß—Ç–æ —Ç–∞–∫–æ–µ –º–µ—Ç—Ä–∏–∫–∏?

–ú–µ—Ç–∫–∏ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –º–∞–ª–æ–µ (–Ω–µ –±–æ–ª–µ–µ 30) –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π. –ö –ø—Ä–∏–º–µ—Ä—É –¥–ª—è time_grade: 
 * 0-100ms
 * 100-200ms
 * 200-500ms
 * 500-100ms
 * 1s-5s
 * 5s-10s
 * –∏ —Ç.–¥.

---

### –ß—Ç–æ —Ç–∞–∫–æ–µ –º–µ—Ç—Ä–∏–∫–∏?

–ü—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –º–µ—Ç—Ä–∏–∫ –Ω–∞–¥–æ –ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ –º–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –ø–æ–∫–∞ —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç. –ö–∞–∫ —Å–µ—Ä–≤–∏—Å —É–º–∏—Ä–∞–µ—Ç –∏–ª–∏ –ø–æ –∫–∞–∫–æ–π-—Ç–æ –¥—Ä—É–≥–æ–π –ø—Ä–∏—á–∏–Ω–µ –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç —Ç—Ä–∞–Ω—Å–ª–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫—É -- –º–æ–≥—É—Ç –±—ã—Ç—å —Å–∞–π–¥-—ç—Ñ—Ñ–µ–∫—Ç—ã. 

–ö –ø—Ä–∏–º–µ—Ä—É: 

<img src="images/metric_fail.png" height="500px">


---

### Prometheus

Prometheus -- —Å–∏—Å—Ç–µ–º–∞, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∞—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö, –∞ —Ç–∞–∫–∂–µ —Å–∏—Å—Ç–µ–º—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫.

–≠—Ç–æ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –æ—Ç —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –∏—Ö –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è. <!-- .element: class="fragment" -->

–û–Ω –∏–º–µ–µ—Ç —Å–≤–æ–π –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —è–∑—ã–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ PromQL. <!-- .element: class="fragment" -->

---

### PromQL

```bash
>> node_load1

node_load1{instance="localhost:9100",job="node"} = 0.96
node_load1{instance="anotherhost:9100",job="node"} = 0.44
```

* node_load1 ‚Äî –∏–º—è –º–µ—Ç—Ä–∏–∫–∏,
* instance –∏ job ‚Äî –∏–º–µ–Ω–∞ –º–µ—Ç–æ–∫,
* localhost:9100 –∏ node ‚Äî —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –º–µ—Ç–æ–∫
* 0.96 ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏.


```bash
>> node_load1{instance!='localhost:9100'}

node_load1{instance="anotherhost:9100",job="node"} = 0.96
```


---

### PromQL

```bash
>> node_filesystem_avail_bytes
node_filesystem_avail_bytes{device="/dev/nvme0n1p1",fstype="vfat",instance="localhost:9100",
job="node",mountpoint="/boot"}  = 143187968
node_filesystem_avail_bytes{device="/dev/nvme0n1p2",fstype="ext4",instance="localhost:9100",
job="node",mountpoint="/"} = 340473708544
node_filesystem_avail_bytes{device="/dev/sda1",fstype="ext4",instance="anotherhost:9100",
job="node",mountpoint="/"} = 429984710656
node_filesystem_avail_bytes{device="run",fstype="tmpfs",instance="localhost:9100",
job="node",mountpoint="/run"} = 4120506368
node_filesystem_avail_bytes{device="tmpfs",fstype="tmpfs",instance="localhost:9100",
job="node",mountpoint="/tmp"} = 4109291520
node_filesystem_avail_bytes{device="tmpfs",fstype="tmpfs",instance="anotherhost:9100",
job="node",mountpoint="/run"} = 104542208
```

---

### PromQL

```bash
>> node_filesystem_avail_bytes / node_filesystem_size_bytes * 100
{device="/dev/nvme0n1p1",fstype="vfat",instance="localhost:9100",job="node",mountpoint="/boot"} = 54.17850016466805
{device="/dev/nvme0n1p2",fstype="ext4",instance="localhost:9100",job="node",mountpoint="/"} = 73.94176693455515
{device="/dev/sda1",fstype="ext4",instance="anotherhost:9100",job="node",mountpoint="/"} = 68.54660550632083
{device="run",fstype="tmpfs",instance="localhost:9100",job="node",mountpoint="/run"} = 99.96800174897272
{device="tmpfs",fstype="tmpfs",instance="localhost:9100",job="node",mountpoint="/tmp"} = 99.69591724179051
{device="tmpfs",fstype="tmpfs",instance="anotherhost:9100",job="node",mountpoint="/run"} = 9

```

---

### PromQL

```bash
>> node_cpu_seconds_total

27687.16node_cpu_seconds_total{cpu="0",instance="localhost:9100",job="node",mode="idle"} = 349.98
node_cpu_seconds_total{cpu="0",instance="localhost:9100",job="node",mode="iowait"} = 0
node_cpu_seconds_total{cpu="0",instance="localhost:9100",job="node",mode="irq"} = 4.5
node_cpu_seconds_total{cpu="0",instance="localhost:9100",job="node",mode="nice"} = 342.47
node_cpu_seconds_total{cpu="0",instance="localhost:9100",job="node",mode="softirq"} = 0
node_cpu_seconds_total{cpu="0",instance="localhost:9100",job="node",mode="steal"} = 734.43
node_cpu_seconds_total{cpu="0",instance="localhost:9100",job="node",mode="system"} = 2386.23
node_cpu_seconds_total{cpu="0",instance="localhost:9100",job="node",mode="user"} = 27613.56
node_cpu_seconds_total{cpu="1",instance="localhost:9100",job="node",mode="idle"} = 328.26

```

---

### PromQL

```bash
>> max by (instance) (node_cpu_seconds_total)
{instance="localhost:9100"} = 18309.45
{instance="anotherhost:9100"} = 3655352.98

>> max by (instance, cpu) (node_cpu_seconds_total)
{cpu="3",instance="localhost:9100"} = 17623.34
{cpu="0",instance="localhost:9100"} = 18295.97
{cpu="0",instance="anotherhost:9100"} = 3529407.76
{cpu="1",instance="localhost:9100"} = 18252.21
{cpu="1",instance="anotherhost:9100"} = 3655379.15
{cpu="2",instance="localhost:9100"} = 18334

>> max without (mode) (node_cpu_seconds_total)
{cpu="1",instance="anotherhost:9100",job="node"} = 3655736.46
{cpu="2",instance="localhost:9100",job="node"} = 18752.74
{cpu="3",instance="localhost:9100",job="node"} = 18022.19
{cpu="0",instance="localhost:9100",job="node"} = 18716.18
{cpu="0",instance="anotherhost:9100",job="node"} = 3529779.38
{cpu="1",instance="localhost:9100",job="node"} = 18670.74
```

---

### –°–æ–±–∏—Ä–∞–µ–º –≤—Å—ë –≤–º–µ—Å—Ç–µ

–ù–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª ```prometheus.yml```.

```yaml
global:
  scrape_interval:     10s
  
scrape_configs:
  - job_name: 'node'
    static_configs:
    - targets: ['192.168.100.17:9100']
```

* 192.168.100.17 -- IP –∞–¥—Ä–µ—Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω –Ω–∞—à —Å–µ—Ä–≤–∏—Å, —á—Ç–æ–±—ã –∫ –Ω–µ–º—É –º–æ–∂–Ω–æ –±—ã–ª–æ –¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è –∏–∑ –¥–æ–∫–µ—Ä–∞ <!-- .element: class="fragment" -->
* 9100 -- –ø–æ—Ä—Ç —Å–µ—Ä–≤–∏—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤–æ–≤–∑—Ä–∞—â–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ <!-- .element: class="fragment" -->


---

### Docker-compose

```yaml
version: "3"

services:
  prometheus:
    image: prom/prometheus
    ports:
      - "9090:9090"
    volumes:
      - "./prometheus.yml:/etc/prometheus/prometheus.yml"
```

---

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–∑ GO

```go
package main

import (
	"net/http"

	"github.com/prometheus/client_golang/prometheus/promhttp"
)

func main() {

	http.Handle("/metrics", promhttp.Handler())
	
	// ...

	println("listening..")
	http.ListenAndServe(":9100", nil)
}

```

---

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–∑ GO

---

```go
// create a new counter vector
var getBookCounter = prometheus.NewCounterVec(
	prometheus.CounterOpts{
		Name: "http_request_get_books_count", // metric name
		Help: "Number of get_books request.",
	},
	[]string{"status"}, // labels
)

func init() {
    // must register counter on init
	prometheus.MustRegister(getBookCounter)
}

```

---

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–∑ GO

```go
func bookHandler(w http.ResponseWriter, r *http.Request) {
	var status string
	defer func() {
        // increment the counter on defer func
		getBookCounter.WithLabelValues(status).Inc()
	}()

	books, err := getBooks(r.FormValue("category"))
	if err != nil {
		status = "error"
		w.Write([]byte("something's wrong: " + err.Error()))
		return
	}

	resp, err := json.Marshal(books)
	if err != nil {
		status = "error"
		w.Write([]byte("something's wrong: " + err.Error()))
		return
	}

	status = "success"
	w.Write(resp)
}

```

---

### Opentracing –∏ Jaeger

–¢—Ä–µ–π—Å –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–Ω—è—Ç—å –∫ –∫–∞–∫–∏–º –¥—Ä—É–≥–∏–º —Å–µ—Ä–≤–∏—Å–∞–º, –ë–î –∏ –ø—Ä–æ—á–µ–º—É –æ–±—Ä–∞—â–∞–ª—Å—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å.

–¢—Ä–µ–π—Å –º–æ–∂–µ—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å–æ–≤, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –±—É–¥–µ—Ç –æ–±–æ–≥–∞—â–∞—Ç—å –µ–≥–æ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏. <!-- .element: class="fragment" -->

–í —Ç—Ä–µ–π—Å –º–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –ª–æ–≥–∏ –∏ –∫–ª—é—á–∏, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–µ —Ç—Ä–µ–π—Å—ã. <!-- .element: class="fragment" -->

Opentracing -- —ç—Ç–æ —Å–≤–æ–±–æ–¥–Ω–æ–µ API –¥–ª—è —Å–±–æ—Ä–∞ —Ç—Ä–µ–π—Å–æ–≤. <!-- .element: class="fragment" --> https://github.com/opentracing/opentracing-go <!-- .element: class="fragment" -->

Jaeger -- —ç—Ç–æ Opentracing-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å–±–æ—Ä—â–∏–∫ —Ç—Ä–µ–π—Å–æ–≤. <!-- .element: class="fragment" --> https://github.com/jaegertracing/jaeger-client-go  <!-- .element: class="fragment" -->


---

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ø—Ä–æ–µ–∫—Ç—É

```go
import (
    "log"
    "os"

    opentracing "github.com/opentracing/opentracing-go"
    "github.com/uber/jaeger-lib/metrics"

    "github.com/uber/jaeger-client-go"
    jaegercfg "github.com/uber/jaeger-client-go/config"
    jaegerlog "github.com/uber/jaeger-client-go/log"
)

...

func main() {
    // Sample configuration for testing. Use constant sampling to sample every trace
    // and enable LogSpan to log every span via configured Logger.
    cfg := jaegercfg.Configuration{
        ServiceName: "your_service_name",
        Sampler:     &jaegercfg.SamplerConfig{
            Type:  jaeger.SamplerTypeConst,
            Param: 1,
        },
        Reporter:    &jaegercfg.ReporterConfig{
            LogSpans: true,
        },
    }

    // Example logger and metrics factory. Use github.com/uber/jaeger-client-go/log
    // and github.com/uber/jaeger-lib/metrics respectively to bind to real logging and metrics
    // frameworks.
    jLogger := jaegerlog.StdLogger
    jMetricsFactory := metrics.NullFactory

    // Initialize tracer with a logger and a metrics factory
    tracer, closer, err := cfg.NewTracer(
        jaegercfg.Logger(jLogger),
        jaegercfg.Metrics(jMetricsFactory),
    )
    // Set the singleton opentracing.Tracer with the Jaeger tracer.
    opentracing.SetGlobalTracer(tracer)
    defer closer.Close()

    // continue main()
}

```

---

### –ó–∞–ø—É—Å–∫ —Ç—Ä–µ–π—Å–∞

```go
import (
    opentracing "github.com/opentracing/opentracing-go"
)

...

tracer := opentracing.GlobalTracer()

span := tracer.StartSpan("say-hello")
println(helloStr)
span.Finish()

```

---

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥—Ç—Ä–µ–π—Å–∞

```go
import (
    opentracing "github.com/opentracing/opentracing-go"
)

...

tracer := opentracing.GlobalTracer()

parentSpan := tracer.StartSpan("parent")
defer parentSpan.Finish()

...

// Create a Child Span. Note that we're using the ChildOf option.
childSpan := tracer.StartSpan(
    "child",
    opentracing.ChildOf(parentSpan.Context()),
)
defer childSpan.Finish()
```

---

### –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –≤ context. –ö–ª–∏–µ–Ω—Ç.

```go
import (
    "net/http"

    opentracing "github.com/opentracing/opentracing-go"
    "github.com/opentracing/opentracing-go/ext"
)

...

tracer := opentracing.GlobalTracer()

clientSpan := tracer.StartSpan("client")
defer clientSpan.Finish()

url := "http://localhost:8082/publish"
req, _ := http.NewRequest("GET", url, nil)

// Set some tags on the clientSpan to annotate that it's the client span. The additional HTTP tags are useful for debugging purposes.
ext.SpanKindRPCClient.Set(clientSpan)
ext.HTTPUrl.Set(clientSpan, url)
ext.HTTPMethod.Set(clientSpan, "GET")

// Inject the client span context into the headers
tracer.Inject(clientSpan.Context(), opentracing.HTTPHeaders, opentracing.HTTPHeadersCarrier(req.Header))
resp, _ := http.DefaultClient.Do(req)
```

---

### –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –≤ context. –°–µ—Ä–≤–µ—Ä.

```go
import (
    "log"
    "net/http"

    opentracing "github.com/opentracing/opentracing-go"
    "github.com/opentracing/opentracing-go/ext"
)

func main() {

    // Tracer initialization, etc.

    ...

    http.HandleFunc("/publish", func(w http.ResponseWriter, r *http.Request) {
        // Extract the context from the headers
        spanCtx, _ := tracer.Extract(opentracing.HTTPHeaders, opentracing.HTTPHeadersCarrier(r.Header))
        serverSpan := tracer.StartSpan("server", ext.RPCServerOption(spanCtx))
        defer serverSpan.Finish()
    })

    log.Fatal(http.ListenAndServe(":8082", nil))
}
```


---


### –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–∞–Ω–≥–ª. load testing) ‚Äî –ø–æ–¥–≤–∏–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —Å–±–æ—Ä –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ-—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã –∏–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ –æ—Ç–≤–µ—Ç –Ω–∞ –≤–Ω–µ—à–Ω–∏–π –∑–∞–ø—Ä–æ—Å —Å —Ü–µ–ª—å—é —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º, –ø—Ä–µ–¥—ä—è–≤–ª—è–µ–º—ã–º –∫ –¥–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ (—É—Å—Ç—Ä–æ–π—Å—Ç–≤—É).

–û–Ω–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–Ω—è—Ç—å –∫–∞–∫–∏–µ –≤–æ–æ–±—â–µ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –µ—Å—Ç—å —É –Ω–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞, –µ–≥–æ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞. <!-- .element: class="fragment" -->

* –¢–∞–Ω–∫ -- —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç—Ä–µ–ª—è–µ—Ç –∏–∑ –ø—É—à–∫–∏ —Å–Ω–∞—Ä—è–¥–æ–º –∏ —Å–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ –≤—ã—Å—Ç—Ä–µ–ª–µ. <!-- .element: class="fragment" -->
* –ü—É—à–∫–∞ -- —Å–∫—Ä–∏–ø—Ç –∏–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞, –∫–æ—Ç–æ—Ä–∞—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–µ—Ä–≤–∏—Å. <!-- .element: class="fragment" -->
* –°–Ω–∞—Ä—è–¥ -- —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–∏—Å (–æ—Ç–¥–µ–ª–Ω—å—ã–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ —Å—Ü–µ–Ω–∞—Ä–∏–π). <!-- .element: class="fragment" -->

---

### –ù–∞–ø–∏—Å–∞–Ω–∏–µ –ø—É—à–∫–∏

–í –∫–∞—á–µ—Å—Ç–≤–µ –ø—É—à–∫–∏ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Yandex.Pandora. 

–≠—Ç–æ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ–ª–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø—É–Ω–∫–∏ –Ω–∞ Go, –∫–æ—Ç–æ—Ä—ã–µ –æ–±–ª–∞–¥–∞—é—Ç –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –æ–±—Å—Ç—Ä–µ–ª–∏–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å. <!-- .element: class="fragment" -->

–ü—Ä–∏–º–µ—Ä —Ç–∞–∫–æ–π –ø—É—à–∫–∏: https://github.com/yandex/pandora/blob/develop/examples/custom_pandora/custom_main.go <!-- .element: class="fragment" -->


---

### –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —Å—Ç—Ä–µ–ª—å–±

–î–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Å—Ç—Ä–µ–ª—å–± —Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞:

```yaml
pools:
- gun:
    type: my-custom-gun-name
    target: example.com:80

  ammo:
    type: my-custom-provider-name
    source: # You may just write file path here. Or stdin.
      type: inline
      data: |
        {"url": "url1", "queryParam": "query1"}
        {"url": "url2", "queryParam": "query2"}
  result:
    type: json
    sink: stdout # Just for interactivity print result to stdout. Usually file used here.

  rps:
    - {duration: 2s, type: line,  from: 1, to: 5}
    - {duration: 3s, type: const, ops: 5}
    - {duration: 2s, type: line,  from: 5, to: 1}
  startup:
    type: once
    times: 5

log:
  level: debug
```

---

### –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —Å—Ç—Ä–µ–ª—å–±

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–∞–¥–æ —É–∫–∞–∑–∞—Ç—å —Ñ–∞–π–ª:

```bash
pandora myconfig.yaml
```

–õ–æ–≥–∏ –º–æ–∂–Ω–æ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ Yandex.Tank, –ª–∏–±–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–µ—Ç—Ä–∏–∫–∏ —Å–µ—Ä–æ–≤–∏—Å–∞ –≤ –≥—Ä–∞—Ñ–∞–Ω–µ.